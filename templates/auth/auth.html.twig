{% extends 'base.html.twig' %} {% block title %}Digi-3 - Page
d'authentification{% endblock %} {% block stylesheets %}
{{ parent() }}
{% endblock %} {% block body_class %}auth-page{% endblock %}
{% block body %}
<main class="auth-container">
  <!-- Section de connexion -->
  <div class="auth-section flex" id="loginSection">
    {{ form_start(login_form, {'attr': {'id': 'login_form', 'class': 'auth-form', 'aria-labelledby': 'login-heading'}}) }}
      <h2 id="login-heading">Connexion</h2>
      <input type="hidden" name="action" value="login" />

      <div class="form-group">
        {{ form_label(login_form.email) }}
        {{ form_widget(login_form.email) }}
        {{ form_errors(login_form.email) }}
      </div>

      <div class="form-group">
        {{ form_label(login_form.password) }}
        <div class="password-container">
          {{ form_widget(login_form.password, {'attr': {'autocomplete': 'current-password'}}) }}
          <span class="toggle-password" data-target="{{ login_form.password.vars.id }}" aria-label="Afficher/Masquer le mot de passe" role="button" tabindex="0">
            <img src="{{ asset('build/images/icons/eye.png') }}" alt="" aria-hidden="true" />
          </span>
        </div>
        {{ form_errors(login_form.password) }}
      </div>

      {% if login_form.remember_me is defined %}
      <div class="form-group form-check">
        {{ form_widget(login_form.remember_me) }}
        {{ form_label(login_form.remember_me) }}
      </div>
      {% endif %}

      <a href="{{ path('app_reset_password_request') }}" id="forgotPasswordLink" class="forgot-password-link">Mot de passe oublié ?</a>

      {% if error %}
      <div class="error" role="alert">{{ error }}</div>
      {% endif %}

      <button type="submit" class="auth-submit">Se connecter</button>
    {{ form_end(login_form) }}
    <div class="auth-decorate flex-col">
      <h3>Bonjour mon ami !</h3>
      <p>
        Entrez vos informations personnelles et commencez l'aventure avec nous
      </p>
      <a href="#" id="switchToRegister" class="auth-switch-btn" aria-label="Passer à l'inscription">S'inscrire</a>
    </div>
  </div>
  <!-- Section d'inscription -->
  <div class="auth-section flex hidden" id="registerSection">
    <div class="auth-decorate flex-col">
      <h3>Content de te revoir !</h3>
      <p>
        Pour rester dans l'aventure avec nous, connectez-vous avec vos
        informations personnelles.
      </p>
      <a href="#" id="switchToLogin" class="auth-switch-btn" aria-label="Passer à la connexion">Se connecter</a>
    </div>
    {{ form_start(registration_form, {'attr': {'id': 'register_form', 'class': 'auth-form', 'aria-labelledby': 'register-heading'}, 'action': path('app_register')}) }}
      <h2 id="register-heading">Inscription</h2>
      <input type="hidden" name="action" value="register" />

      <div class="form-group">
        {{ form_label(registration_form.first_name) }}
        {{ form_widget(registration_form.first_name) }}
        {{ form_errors(registration_form.first_name) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.last_name) }}
        {{ form_widget(registration_form.last_name) }}
        {{ form_errors(registration_form.last_name) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.email) }}
        {{ form_widget(registration_form.email) }}
        {{ form_errors(registration_form.email) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.password.first) }}
        <div class="password-container">
          {{ form_widget(registration_form.password.first, {'attr': {'autocomplete': 'new-password'}}) }}
          <span class="toggle-password" data-target="{{ registration_form.password.first.vars.id }}" aria-label="Afficher/Masquer le mot de passe" role="button" tabindex="0">
            <img src="{{ asset('build/images/icons/eye.png') }}" alt="" aria-hidden="true" />
          </span>
        </div>
        {{ form_errors(registration_form.password.first) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.password.second) }}
        <div class="password-container">
          {{ form_widget(registration_form.password.second, {'attr': {'autocomplete': 'new-password'}}) }}
          <span class="toggle-password" data-target="{{ registration_form.password.second.vars.id }}" aria-label="Afficher/Masquer le mot de passe" role="button" tabindex="0">
            <img src="{{ asset('build/images/icons/eye.png') }}" alt="" aria-hidden="true" />
          </span>
        </div>
        {{ form_errors(registration_form.password.second) }}
      </div>

      <div class="form-group form-check">
        {{ form_widget(registration_form.agreeTerms) }}
        {{ form_label(registration_form.agreeTerms) }}
        {{ form_errors(registration_form.agreeTerms) }}
      </div>

      {% if error %}
      <div class="error" role="alert">{{ error }}</div>
      {% endif %}

      <button type="submit" class="auth-submit">S'inscrire</button>
    {{ form_end(registration_form) }}
  </div>
</main>

{% for label, messages in app.flashes %}
  {% for message in messages %}
    <div class="flash-{{ label }}" role="alert">
      {{ message }}
    </div>
  {% endfor %}
{% endfor %}

{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="{{ asset('build/auth.js') }}"></script>
<script>
  // Script inline pour tester si le JavaScript fonctionne
  console.log("Script inline chargé");
  
  document.addEventListener("DOMContentLoaded", function() {
    console.log("DOM chargé - Script inline");
    
    // Éléments DOM
    const loginSection = document.getElementById("loginSection");
    const registerSection = document.getElementById("registerSection");
    const switchToRegister = document.getElementById("switchToRegister");
    const switchToLogin = document.getElementById("switchToLogin");
    
    console.log("Éléments DOM récupérés:", {
      loginSection: loginSection ? "trouvé" : "non trouvé",
      registerSection: registerSection ? "trouvé" : "non trouvé",
      switchToRegister: switchToRegister ? "trouvé" : "non trouvé",
      switchToLogin: switchToLogin ? "trouvé" : "non trouvé"
    });
    
    // Définition des fonctions de navigation entre les sections
    function showRegisterSection() {
      console.log("Affichage de la section d'inscription");
      if (loginSection) loginSection.classList.add('hidden');
      if (registerSection) registerSection.classList.remove('hidden');
    }
    
    function showLoginSection() {
      console.log("Affichage de la section de connexion");
      if (registerSection) registerSection.classList.add('hidden');
      if (loginSection) loginSection.classList.remove('hidden');
    }
    
    // Gestion des événements de navigation
    if (switchToRegister) {
      console.log("Configuration du bouton pour passer à l'inscription");
      switchToRegister.addEventListener("click", function(event) {
        console.log("Clic sur le bouton pour passer à l'inscription");
        event.preventDefault();
        showRegisterSection();
      });
    }
    
    if (switchToLogin) {
      console.log("Configuration du bouton pour passer à la connexion");
      switchToLogin.addEventListener("click", function(event) {
        console.log("Clic sur le bouton pour passer à la connexion");
        event.preventDefault();
        showLoginSection();
      });
    }
  });
</script>
{% endblock %}
