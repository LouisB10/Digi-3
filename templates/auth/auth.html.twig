{% extends 'base.html.twig' %} {% block title %}Digi-3 - Page
d'authentification{% endblock %} {% block stylesheets %}
{{ parent() }}
{% endblock %} {% block body_class %}auth-page{% endblock %}
{% block body %}
<!-- Flash messages container - moved to top and styled for better visibility -->
<div class="flash-messages-container">
  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div class="flash-message flash-{{ label }}" role="alert">
        <div class="flash-content">
          <span class="flash-icon">{% if label == 'error' %}⚠️{% else %}✓{% endif %}</span>
          <span class="flash-text">{{ message }}</span>
        </div>
        <button type="button" class="flash-close" aria-label="Fermer">×</button>
      </div>
    {% endfor %}
  {% endfor %}
  
  {% if error %}
  <div class="flash-message flash-error" role="alert">
    <div class="flash-content">
      <span class="flash-icon">⚠️</span>
      <span class="flash-text">{{ error }}</span>
    </div>
    <button type="button" class="flash-close" aria-label="Fermer">×</button>
  </div>
  {% endif %}
</div>

<main class="auth-container">
  <!-- Section de connexion -->
  <div class="auth-section flex" id="loginSection">
    {{ form_start(login_form, {'attr': {'id': 'login_form', 'class': 'auth-form', 'aria-labelledby': 'login-heading'}}) }}
      <h2 id="login-heading">Connexion</h2>
      <input type="hidden" name="action" value="login" />

      <div class="form-group">
        {{ form_label(login_form.email) }}
        {{ form_widget(login_form.email) }}
        {{ form_errors(login_form.email) }}
      </div>

      <div class="form-group">
        {{ form_label(login_form.password) }}
        <div class="password-container">
          {{ form_widget(login_form.password, {'attr': {'autocomplete': 'current-password'}}) }}
          <span class="toggle-password" data-target="{{ login_form.password.vars.id }}" aria-label="Afficher/Masquer le mot de passe" role="button" tabindex="0">
            <img src="{{ asset('build/images/icons/eye.png') }}" alt="" aria-hidden="true" />
          </span>
        </div>
        {{ form_errors(login_form.password) }}
      </div>

      {% if login_form.remember_me is defined %}
      <div class="form-group form-check">
        {{ form_widget(login_form.remember_me) }}
        {{ form_label(login_form.remember_me) }}
      </div>
      {% endif %}

      <a href="{{ path('app_reset_password_request') }}" id="forgotPasswordLink" class="forgot-password-link">Mot de passe oublié ?</a>

      <button type="submit" class="auth-submit">Se connecter</button>
    {{ form_end(login_form) }}
    <div class="auth-decorate flex-col">
      <h3>Bonjour mon ami !</h3>
      <p>
        Entrez vos informations personnelles et commencez l'aventure avec nous
      </p>
      <a href="#" id="switchToRegister" class="auth-switch-btn" aria-label="Passer à l'inscription">S'inscrire</a>
    </div>
  </div>
  <!-- Section d'inscription -->
  <div class="auth-section flex hidden" id="registerSection">
    <div class="auth-decorate flex-col">
      <h3>Content de te revoir !</h3>
      <p>
        Pour rester dans l'aventure avec nous, connectez-vous avec vos
        informations personnelles.
      </p>
      <a href="#" id="switchToLogin" class="auth-switch-btn" aria-label="Passer à la connexion">Se connecter</a>
    </div>
    {{ form_start(registration_form, {'attr': {'id': 'register_form', 'class': 'auth-form', 'aria-labelledby': 'register-heading'}, 'action': path('app_register')}) }}
      <h2 id="register-heading">Inscription</h2>
      <input type="hidden" name="action" value="register" />

      <div class="form-group">
        {{ form_label(registration_form.first_name) }}
        {{ form_widget(registration_form.first_name) }}
        {{ form_errors(registration_form.first_name) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.last_name) }}
        {{ form_widget(registration_form.last_name) }}
        {{ form_errors(registration_form.last_name) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.email) }}
        {{ form_widget(registration_form.email) }}
        {{ form_errors(registration_form.email) }}
      </div>

      <div class="form-group">
        {{ form_label(registration_form.password.first) }}
        <div class="password-container">
          {{ form_widget(registration_form.password.first, {'attr': {'autocomplete': 'new-password'}}) }}
          <span class="toggle-password" data-target="{{ registration_form.password.first.vars.id }}" aria-label="Afficher/Masquer le mot de passe" role="button" tabindex="0">
            <img src="{{ asset('build/images/icons/eye.png') }}" alt="" aria-hidden="true" />
          </span>
        </div>
        {{ form_errors(registration_form.password.first) }}
      </div>
      
      <div id="password-requirements" class="password-requirements">
        <ul>
          <li id="req-length">Au moins 8 caractères</li>
          <li id="req-uppercase">Au moins une majuscule</li>
          <li id="req-lowercase">Au moins une minuscule</li>
          <li id="req-number">Au moins un chiffre</li>
          <li id="req-special">Au moins un caractère spécial</li>
        </ul>
      </div>

      <div class="form-group">
        {{ form_label(registration_form.password.second) }}
        <div class="password-container">
          {{ form_widget(registration_form.password.second, {'attr': {'autocomplete': 'new-password'}}) }}
          <span class="toggle-password" data-target="{{ registration_form.password.second.vars.id }}" aria-label="Afficher/Masquer le mot de passe" role="button" tabindex="0">
            <img src="{{ asset('build/images/icons/eye.png') }}" alt="" aria-hidden="true" />
          </span>
        </div>
        {{ form_errors(registration_form.password.second) }}
      </div>

      <div id="registerErrors" class="error-container"></div>

      <button type="submit" class="auth-submit">S'inscrire</button>
    {{ form_end(registration_form) }}
  </div>
</main>

<!-- Hidden data pour le JavaScript -->
<div id="formState" data-has-errors="{{ (error is not null or app.flashes|length > 0) ? 'true' : 'false' }}"></div>

{% endblock %}

{% block javascripts %}
{{ parent() }}
{{ encore_entry_script_tags('auth') }}
{% endblock %}
